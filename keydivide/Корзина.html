<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>KeyDivide –°–∞–π—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä</title>
    <link rel="stylesheet" href="assets/css/navpanel.css">
    <link rel="stylesheet" href="assets/css/footer.css">
    <link rel="stylesheet" href="assets/css/footer_phone.css">
    <link rel="stylesheet" href="assets/css/basket.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<header class="header">
    <div class="container">
        <div class="header__inner">
            <div><a class="header__logo" href="–ì–ª–∞–≤–Ω–∞—è.html">KeyDivide</a></div>

            <nav class="nav">
                <ul>
                    <li class="_link"><a class="nav__link" href="–ì–ª–∞–≤–Ω–∞—è.html#keyboards">–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã</a></li>
                    <li class="_link"><a class="nav__link" href="–ì–ª–∞–≤–Ω–∞—è.html#services">–£—Å–ª—É–≥–∏</a></li>
                    <li class="_link"><a class="nav__link" href="–ì–ª–∞–≤–Ω–∞—è.html#aboutus">–û –Ω–∞—Å</a></li>
                    <li class="_link"><a class="nav__link" href="#">–°–æ—Ü—Å–µ—Ç–∏</a>
                        <ul class="url">
                            <li class="two_link" style="margin-top: 10px;"><a class="url__link" href="https://discord.gg/PKZ8ejUB8Z" target="_blank">Discord</a></li>
                            <li class="two_link"><a class="url__link" href="https://vk.com/cacao_keyboards" target="_blank">–í–∫–æ–Ω—Ç–∞–∫—Ç–µ</a></li>
                            <li class="two_link"><a class="url__link" href="https://www.youtube.com/@cacaoboards7930/featured" target="_blank">YouTube</a></li>
                        </ul>
                    </li>					
                </ul>   
            </nav>
        </div>
		<div>
			<a class="ikon" href="–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.html" title="–ü—Ä–æ—Ñ–∏–ª—å"><img src="assets/images/–∞–∫–∫–∞—É–Ω—Ç.png" width="26" height="24"></a>
			<a class="ikon" title="–ö–æ—Ä–∑–∏–Ω–∞"><img src="assets/images/–∫–æ—Ä–∑–∏–Ω–∞.png" width="26" height="26"></a>
		</div>
    </div>
</header>

<div class="box" id="cartContainer">
  <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–æ–≤–∞—Ä—ã –ª–∏–±–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ -->
</div>
<div style="margin-top: 20px; text-align: center;">
  <button id="orderBtn" class="button" style="padding: 10px 20px; font-size: 16px;">–ó–∞–∫–∞–∑–∞—Ç—å</button>
</div>




<div class="footer">
    <div class="footbox">
        <div class="line"></div>
        <div class="colums">
            <div class="col1">
                <h1>KeyDivide</h1>
                <p>made by people for people</p>
            </div>
            <div class="colinfo">
                <div class="col2">
                    <h1 class="coltitle">–ú–∞–≥–∞–∑–∏–Ω</h1>
                    <p class="coltext"><a href="#keyboards">–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã</a></p>
                    <p class="coltext"><a href="#services">–£—Å–ª—É–≥–∏</a></p>
                </div>
                <div class="col3">
                    <h1 class="coltitle">–°–æ—Ü—Å–µ—Ç–∏</h1>
                    <a href="https://discord.gg/PKZ8ejUB8Z" target="_blank"><p class="coltext">Discord</p></a>
                    <a href="https://vk.com/cacao_keyboards" target="_blank"><p class="coltext">–í–∫–æ–Ω—Ç–∞–∫—Ç–µ</p></a>
                    <a href="https://www.youtube.com/@cacaoboards7930/featured" target="_blank"><p class="coltext">YouTube</p></a>  
                </div>
                <div class="col4">
                    <h1 class="coltitle">–ò–Ω—Ñ–æ</h1>
                    <p class="coltext"><a href="#aboutus">–û –Ω–∞—Å</a></p>
                </div>
                <div class="col5">
                    <h1 class="coltitle">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h1>
                    <p>–ü–æ –ø–æ–≤–æ–¥—É –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö –ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Discord –∏–ª–∏ of_cacaoboards@mail.ru</p>
                </div>
            </div>
        </div>
    </div>
    <div class="by">
        <div class="byby">
            <p>¬©CacaoBoards All Rights Reserved</p>
            <p>Designed with ‚ù§Ô∏è by neyman</p>
        </div>
    </div>
</div>
<script src="modalw.js"></script>

<script>



  window.onload = function() {
    const isAuth = localStorage.getItem('isAuthenticated');
    const username = localStorage.getItem('username');
    const cartContainer = document.getElementById('cartContainer');

    if (isAuth !== 'true' || !username) {
      cartContainer.innerHTML = `
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, <a href="–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.html">–≤–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ—Ä–∑–∏–Ω—É.</p>
      `;
      return;
    }

    const cartKey = `cart_${username}`;
    const cart = JSON.parse(localStorage.getItem(cartKey));

    if (!cart || cart.length === 0) {
      // –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –±–ª–æ–∫–∞ .nonein
      cartContainer.innerHTML = `
        <div class="nonein">
          <p>–í –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–∫–∞ –ø—É—Å—Ç–æ, –Ω–æ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</p>
          <a href="–ì–ª–∞–≤–Ω–∞—è.html#keyboards" class="button">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–±–æ—Ä—É</a>
        </div>
      `;
      return;
    }

    // –ï—Å—Ç—å —Ç–æ–≤–∞—Ä—ã ‚Äî —Å—Ç—Ä–æ–∏–º —Å–ø–∏—Å–æ–∫
    let html = '<h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞:</h2><ul class="cart-list" style="list-style:none; padding:0;">';

    let totalPrice = 0;

    cart.forEach(item => {
      const itemTotal = (item.price || 0) * (item.quantity || 1);
      totalPrice += itemTotal;

      html += `
        <li style="border-bottom:1px solid #ccc; padding:10px 0;">
          <strong>${item.productName || '–¢–æ–≤–∞—Ä'}</strong><br/>
          ${item.switchName ? `<em>–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å: ${item.switchName}</em><br/>` : ''}
          –ö–æ–ª-–≤–æ: ${item.quantity || 1}<br/>
          –¶–µ–Ω–∞ –∑–∞ —à—Ç: ${item.price ? item.price.toLocaleString('ru-RU') + ' ‚ÇΩ' : '‚Äì'}<br/>
          –ò—Ç–æ–≥: ${itemTotal.toLocaleString('ru-RU')} ‚ÇΩ
        </li>
      `;
    });

    html += `</ul>`;
    html += `<p style="font-weight:bold; margin-top:10px;">–û–±—â–∞—è —Å—É–º–º–∞: ${totalPrice.toLocaleString('ru-RU')} ‚ÇΩ</p>`;

    cartContainer.innerHTML = html;
  };
</script>

<script>
  // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã
  function renderCart() {
    const isAuth = localStorage.getItem('isAuthenticated');
    const username = localStorage.getItem('username');
    const cartContainer = document.getElementById('cartContainer');

    if (isAuth !== 'true' || !username) {
      cartContainer.innerHTML = `
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, <a href="–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.html">–≤–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ—Ä–∑–∏–Ω—É.</p>
      `;
      return;
    }

    const cartKey = `cart_${username}`;
    let cart = JSON.parse(localStorage.getItem(cartKey)) || [];

    if (cart.length === 0) {
      cartContainer.innerHTML = `
        <div class="nonein">
          <p>–í –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–∫–∞ –ø—É—Å—Ç–æ, –Ω–æ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</p>
          <a href="–ì–ª–∞–≤–Ω–∞—è.html#keyboards" class="button">–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–±–æ—Ä—É</a>
        </div>
      `;
      return;
    }

    let totalPrice = 0;
    let html = '<h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞:</h2><ul class="cart-list" style="list-style:none; padding:0;">';

    cart.forEach((item, index) => {
      const itemTotal = (item.price || 0) * (item.quantity || 1);
      totalPrice += itemTotal;

      html += `
        <li style="border-bottom:1px solid #ccc; padding:10px 0; display:flex; align-items:center; justify-content: space-between;">
          <div>
            <strong>${item.productName || '–¢–æ–≤–∞—Ä'}</strong><br/>
            ${item.switchName ? `<em>–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å: ${item.switchName}</em><br/>` : ''}
            –¶–µ–Ω–∞ –∑–∞ —à—Ç: ${item.price ? item.price.toLocaleString('ru-RU') + ' ‚ÇΩ' : '‚Äì'}
          </div>
          <div style="display:flex; align-items:center;">
            <button data-index="${index}" class="btn-decrease" style="margin-right:5px;">‚àí</button>
            <span style="width:30px; text-align:center;">${item.quantity || 1}</span>
            <button data-index="${index}" class="btn-increase" style="margin-left:5px;">+</button>
            <button data-index="${index}" class="btn-remove" style="margin-left:15px; color:red;" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
          </div>
          <div style="min-width:80px; text-align:right;">
            <strong>${itemTotal.toLocaleString('ru-RU')} ‚ÇΩ</strong>
          </div>
        </li>
      `;
    });

    html += `</ul>`;
    html += `<p style="font-weight:bold; margin-top:10px;">–û–±—â–∞—è —Å—É–º–º–∞: ${totalPrice.toLocaleString('ru-RU')} ‚ÇΩ</p>`;

    cartContainer.innerHTML = html;

    // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
    cartContainer.querySelectorAll('.btn-increase').forEach(button => {
      button.onclick = () => {
        const idx = +button.getAttribute('data-index');
        cart[idx].quantity = (cart[idx].quantity || 1) + 1;
        localStorage.setItem(cartKey, JSON.stringify(cart));
        renderCart();
      };
    });

    cartContainer.querySelectorAll('.btn-decrease').forEach(button => {
      button.onclick = () => {
        const idx = +button.getAttribute('data-index');
        if ((cart[idx].quantity || 1) > 1) {
          cart[idx].quantity -= 1;
          localStorage.setItem(cartKey, JSON.stringify(cart));
          renderCart();
        } else {
          // –ú–æ–∂–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä, –µ—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ 1 –∏ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "‚àí"
          if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')) {
            cart.splice(idx, 1);
            localStorage.setItem(cartKey, JSON.stringify(cart));
            renderCart();
          }
        }
      };
    });

    cartContainer.querySelectorAll('.btn-remove').forEach(button => {
      button.onclick = () => {
        const idx = +button.getAttribute('data-index');
        if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')) {
          cart.splice(idx, 1);
          localStorage.setItem(cartKey, JSON.stringify(cart));
          renderCart();
        }
      };
    });
  }

  window.onload = renderCart;


  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ó–∞–∫–∞–∑–∞—Ç—å"
  document.getElementById('orderBtn').onclick = () => {
  const isAuth = localStorage.getItem('isAuthenticated');
  const username = localStorage.getItem('username');

  if (isAuth !== 'true' || !username) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.');
    window.location.href = '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.html';
    return;
  }

  const cartKey = `cart_${username}`;
  const cart = JSON.parse(localStorage.getItem(cartKey)) || [];

  if (cart.length === 0) {
    alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.');
    return;
  }

  // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑—ã
  const orderKey = `orders_${username}`;
  const existingOrders = JSON.parse(localStorage.getItem(orderKey)) || [];

  const updatedOrders = [...existingOrders, ...cart];
  localStorage.setItem(orderKey, JSON.stringify(updatedOrders));

  // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
  localStorage.removeItem(cartKey);

  alert(`–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑! –í—ã –∑–∞–∫–∞–∑–∞–ª–∏ ${cart.length} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—É–º–º—É ${cart.reduce((sum, item) => sum + (item.price || 0) * (item.quantity || 1), 0).toLocaleString('ru-RU')} ‚ÇΩ`);

  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ –ø—Ä–æ—Ñ–∏–ª—å
  window.location.href = 'login copy.html';
};

  
</script>
</body>
</html>
